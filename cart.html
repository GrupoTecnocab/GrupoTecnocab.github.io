<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="carrito.css">
    <script src="https://kit.fontawesome.com/d0deee4c58.js" crossorigin="anonymous"></script>
    <link rel="shortcut icon" href="img/logo tecnocab_.png">
    <title>Carrito</title>
</head>
<body>
    <nav>
        <div class="contenedor-nav">
            <div class="busqueda">
                <input type="text" placeholder="Busacar" id="buscador">
                <div class="busqueda-ico" id="searchBtn">
                    <svg xmlns="http://www.w3.org/2000/svg" id="busqueda" viewBox="0 0 30 30" width="30" height="30" preserveAspectRatio="xMidYMid meet" style="width: 100%; height: 100%;"><defs><clipPath id="__lottie_element_2"><rect width="30" height="30" x="0" y="0"></rect></clipPath></defs><g clip-path="url(#__lottie_element_2)"><g transform="matrix(1,0,0,1,0,0.18700027465820312)" opacity="1" style="display: block;"><g opacity="1" transform="matrix(1,0,0,1,13,13)"><path stroke-linecap="butt" stroke-linejoin="miter" fill-opacity="0" stroke-miterlimit="10" stroke="rgb(0,0,0)" stroke-opacity="1" stroke-width="2" d=" M0,-9 C-4.9710001945495605,-9 -9,-4.9710001945495605 -9,0 C-9,4.9710001945495605 -4.9710001945495605,9 0,9 C4.9710001945495605,9 9,4.9710001945495605 9,0 C9,-4.9710001945495605 4.9710001945495605,-9 0,-9z"></path></g><g opacity="1" transform="matrix(1,0,0,1,22.718000411987305,22.7189998626709)"><path stroke-linecap="round" stroke-linejoin="miter" fill-opacity="0" stroke-miterlimit="10" stroke="rgb(0,0,0)" stroke-opacity="1" stroke-width="2" d=" M3.2820000648498535,3.2809998989105225 C3.2820000648498535,3.2809998989105225 -3.2809998989105225,-3.2809998989105225 -3.2809998989105225,-3.2809998989105225"></path></g></g></g></svg>
                </div>
            </div>
            <div class="logo">
                <img src="img/logo tecnocab_.png" alt="">
            </div>
            <div class="nombre_empresa">
                <h1>
                    Grupo Tecnocab
                </h1>
            </div>
            <div class="contacto">
                <button class="btncon" id="inicio"><i class="fa-solid fa-house"></i></button>
                <button class="btncon" onclick="goToCart()"><i class="fa-solid fa-cart-shopping"><span id="cart-count">0</span></i></button>
                <button class="btncon"><i class="fa-solid fa-users"></i></button>
            </div>
        </div>
    </nav>

    <h2>Carrito de compras</h2>
    <table id="cart">
        <thead>
            <tr>
                <th>Producto</th>
                <th>Precio</th>
                <th>Cantidad</th>
                <th>Subtotal</th>
            </tr>
        </thead>
        <tbody id="cart-items">
        </tbody>
        <tfoot>
            <tr>
                <td colspan="3">Total:</td>
                <td id="total">$0</td>
            </tr>
        </tfoot>
    </table>

    <button id="whts" onclick="sendCartToWhatsApp()">Enviar por WhatsApp</button>
    <button id="clear-cart" onclick="clearCart()">Limpiar carrito</button>

    <script defer src="stock.js"></script>
</body>
<script>
    // Función para cargar y mostrar los productos en el carrito
function loadCart() {
    console.log(item)
    const cartItemsContainer = document.getElementById('cart-items');
    const totalElement = document.getElementById('total');
    let total = 0;

    let cart = JSON.parse(localStorage.getItem('cart')) || [];

    if (cart.length === 0) {
        cartItemsContainer.innerHTML = '<p>No hay productos en el carrito.</p>';
    } else {
        cartItemsContainer.innerHTML = '';

        cart.forEach(item => {
            const product = item;
            const quantity = item.quantity;
            const subtotal = product.price * quantity;
            total += subtotal;

            const itemElement = document.createElement('tr');
            itemElement.classList.add('cart-item');
            itemElement.innerHTML = `
                <th>${product.nombre}</th>
                <th>$${product.precio}</th>
                <th>
                    <div class="juntos">
                        <input id="cantidad" type="number" value="${quantity}" min="1" onchange="updateQuantity(${product.id}, this.value)">
                        <button id="btn-elimi" onclick="removeFromCart(${product.id})"><i class="fa-solid fa-trash"></i></button>
                    </div>
                </th>
                <th>$${subtotal}</th>
            `;

            cartItemsContainer.appendChild(itemElement);
        });
    }

    totalElement.textContent = `$${total.toFixed(2)}`;
}

function loadCart() {
    const cartItemsContainer = document.getElementById('cart-items');
    const totalElement = document.getElementById('total');
    const clearCartButton = document.getElementById('clear-cart'); // Botón para limpiar el carrito
    let total = 0;

    let cart = JSON.parse(localStorage.getItem('cart')) || [];

    if (cart.length === 0) {
        cartItemsContainer.innerHTML = '<p>No hay productos en el carrito.</p>';
        clearCartButton.style.display = 'none'; // Ocultar el botón cuando el carrito esté vacío
    } else {
        cartItemsContainer.innerHTML = '';

        cart.forEach(item => {
            const product = item.product;
            const quantity = item.quantity;
            const precioc= parseFloat(product.precio)
            const subtotal = precioc * quantity;
            total += subtotal

            const itemElement = document.createElement('tr');
            itemElement.classList.add('cart-item');
            itemElement.innerHTML = `
                <th>${product.nombre}</th>
                <th>$${formatNumberWithCommas(product.precio)}</th>
                <th>
                    <div class="juntos">
                        <input id="cantidad" type="number" value="${quantity}" min="1" onchange="updateQuantity(${product.id}, this.value)">
                        <button id="btn-elimi" onclick="removeFromCart(${product.id})"><i class="fa-solid fa-trash"></i></button>
                    </div>
                </th>
                <th>$${formatNumberWithCommas(subtotal)}</th>
            `;

            cartItemsContainer.appendChild(itemElement);
        });

        clearCartButton.style.display = 'block'; // Mostrar el botón cuando haya productos en el carrito
    }

    totalElement.textContent = `$${formatNumberWithCommas(total.toFixed(2))}`;
}

// Función para limpiar el carrito
function clearCart() {
    localStorage.removeItem('cart');
    loadCart();
    updateCartCount()
}


// Función para actualizar la cantidad de un producto en el carrito
function updateQuantity(productId, quantity) {
    let cart = JSON.parse(localStorage.getItem('cart')) || [];
    const existingProductIndex = cart.findIndex(item => item.product.id === productId);
    if (existingProductIndex !== -1) {
        cart[existingProductIndex].quantity = parseInt(quantity);
        localStorage.setItem('cart', JSON.stringify(cart));
        loadCart();
        updateCartCount();
    }
}

// Función para eliminar un producto del carrito
function removeFromCart(productId) {
    let cart = JSON.parse(localStorage.getItem('cart')) || [];
    const updatedCart = cart.filter(item => item.product.id !== productId);
    localStorage.setItem('cart', JSON.stringify(updatedCart));
    loadCart();
    updateCartCount()
}

// Función para vaciar el carrito
function clearCart() {
    localStorage.removeItem('cart');
    loadCart();
    updateCartCount()
}

// Función para enviar el carrito por WhatsApp
function sendCartToWhatsApp() {
  const cart = getCart();
  const total = calculateTotal(cart);

  let message = "Carrito de Compra:\n";

  cart.forEach(item => {
    const product = item.product;
    const quantity = item.quantity;
    const totalPrice = product.precio * quantity;
    message += `Id: ${product.id} - ${product.nombre} - Cantidad: ${quantity} - Precio Unitario:$${product.precio} - Precio Total: $${totalPrice}\n`;
  });

  message += `\nTotal de la compra: $${total}`;

  // Reemplaza el número de teléfono con el que deseas enviar el mensaje
  const phoneNumber = "529991749247";

  // Reemplaza "Su mensaje" con el mensaje que deseas enviar
  const encodedMessage = encodeURIComponent(message);
  const whatsappUrl = `https://api.whatsapp.com/send?phone=${phoneNumber}&text=${encodedMessage}`;

  window.open(whatsappUrl);
}

function getCart() {
  const cart = localStorage.getItem("cart");
  return cart ? JSON.parse(cart) : [];
}

// Función para calcular el total de la compra
function calculateTotal(cart) {
  let total = 0;
  cart.forEach(item => {
    const product = item.product;
    const quantity = item.quantity;
    total += product.precio * quantity;
  });
  return total;
}


// Función para obtener el total de la compra
function getTotalPrice() {
    let total = 0;
    const cart = JSON.parse(localStorage.getItem('cart')) || [];
    cart.forEach(item => {
        const product = item;
        const quantity = item.quantity;
        total += product.precio * quantity;
    });
    return `$${formatNumberWithCommas(total)}`;
}

// Función para dividir números por miles con coma
function formatNumberWithCommas(number) {
  return number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}

// Cargar el carrito al cargar la página
window.onload = function () {
    loadCart();
};

inicio.addEventListener("click", function() {
    window.location.href = "index.html";
  });

  function goToCart() {
    window.location.href = 'cart.html';
}

let inicio2 = document.querySelector(".logo")
inicio2.addEventListener("click",()=>{
    window.location.href = 'index.html';
})

function updateCartCount() {
    const cart = getCart();
    const cartCount = cart.length; // Obtener la longitud del arreglo para obtener el número de productos diferentes
    const cartCountElement = document.getElementById("cart-count");
    cartCountElement.textContent = cartCount.toString();
}

  updateCartCount();

</script>
</html>